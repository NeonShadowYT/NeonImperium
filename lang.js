const translations = {
    ru: {
        navHome: "Neon Imperium",
        navStarve: "Starve Neon",
        navAlpha: "Alpha 01",
        navGc: "ГК Адвенчур",
        siteTitle: "Neon Imperium",
        mainProjectsTitle: "Главные проекты",
        mainProjectsDesc: "Игры с приоритетом разработки",
        starveDesc: "Выживание в брутальном мире с прокачкой и генетикой.",
        alphaDesc: "Top-down шутер, где вы робот, помогающий солдатам.",
        gcDesc: "Просто приключение ГКТМО.",
        detailsBtn: "Подробнее",
        smallProjectsTitle: "Небольшие проекты",
        smallProjectsDesc: "Игры созданные по рофлу",
        pnsd1Desc: "Первая часть безумной серии.",
        pnsd2Desc: "Продолжение, ещё безумнее.",
        comingSoon: "Скоро",
        developersTitle: "Разработчики",
        developersDesc: "Работаем в свободное время",
        youtubersTitle: "Ютуберы",
        youtubersDesc: "Собираем комьюнити",
        trailerTitle: "Трейлер",
        developerTitle: "Разработчик",
        downloadTitle: "Скачать",
        descriptionTitle: "Описание",
        videoTitle: "Видео",
        videoDesc: "Подборка контента от сообщества",
        updatesTitle: "Обновления",
        polls: "Опросы",
        downloadNote: "Доступно на нескольких платформах. Следите за обновлениями!",
        starveVersion: "Объединение 0.13.7",
        worldTitle: "Игровой мир",
        worldDesc: "БРУТАЛЬНЫЙ ХАРДКОРНЫЙ МИР. Я не буду держать тебя за руку, приятель. Я оставлю небольшой туториал по базовой механике, а дальше ты сам по себе ;}",
        statusTitle: "Статус",
        statusDesc: "Starve Neon находится на ранней стадии разработки, но открыт для кроссплатформенного многопользовательского тестирования.",
        developmentTitle: "Развитие",
        developmentDesc: "Полная система развития от копий и мечей до ГРЕБАНОГО МИНИГАНА, ЧУВАК! Броня для разных биомов, модули и система генетики, подобная RimWorld.",
        alliesTitle: "Союзники",
        alliesDesc: "Создавай союзы с фракциями и другими игроками, участвуй в битвах на арене и приручай животных. Отправляйся кланом на рейд подобно Rust.",
        featuresTitle: "Особенности",
        feature1: "Интернет необязателен.",
        feature2: "Частые крупные обновления.",
        feature3: "Встроенная поддержка модов.",
        feature4: "Прямое общение с разработчиком.",
        feature5: "Многоязычная поддержка и простое добавление пользовательских языков и шрифтов.",
        requirementsTitle: "Системные требования",
        requirementsNote: "Примерные значения основанные на стандартных настройках для этих устройств",
        fps60: "60+ Фпс",
        cpu60: "Процессор: Xeon-E2650 v2 3.00 GHz",
        gpu60: "Видеокарта: GT 730 4GB",
        fps180: "180+ Фпс",
        cpu180: "Процессор: AMD Athlon X4 840 3.10 GHz",
        gpu180: "Видеокарта: GT 1030 2GB",
        fps1000: "1000+ Фпс",
        cpu1000: "Процессор: AMD Ryzen 7 7435HS 4.00 GHz",
        gpu1000: "Видеокарта: RTX 3050 4GB Laptop",
        consumptionTitle: "Потребление",
        consumptionNote: "Примерные значения",
        vram: "Видеопамять",
        vramVal: "512-1024 Мб",
        ram: "Оперативка",
        ramVal: "512-1024 Мб",
        storage: "Память",
        storageVal: "256 Мб",
        os: "Система",
        osVal: "Win 10+ 32 Бит / Андроид 7+",
        video1Title: "Обзор Starve Neon",
        video2Title: "Гайд для новичков",
        video3Title: "Прохождение мультиплеера",
        video4Title: "Лучшие моменты",
        video5Title: "Секреты и пасхалки",
        starveUpdateTitle: "Патч 0.13.7",
        spoilerTutorial: "Туториал",
        tutorialContent: "Цели по всей игре",
        spoilerRewards: "Награды",
        rewardsContent: "Локализация\nУлучшены возможности перевода",
        spoilerQuality: "Удобства",
        qualityContent: "Интерфейс\nУправление",
        spoilerBalance: "Баланс",
        balanceContent: "Награды за уровень\nИзменение прогрессии",
        spoilerBugfix: "Багфикс",
        bugfixContent: "Множество мелких исправлений",
        alphaVersion: "Патч 0.0.5.2",
        alphaDownloadNote: "Версия 0.0.5.2 · Обновление от 21.01.2024",
        alphaStoryTitle: "Сюжет",
        alphaStoryDesc: "Alpha 01 это top-down шутер в котором вы: робот который должен помочь солдатам, но потом всё становится сложнее чем просто помощь...",
        alphaStatusTitle: "Статус",
        alphaStatusDesc: "Игра находится в активной разработке. Текущая версия: 0.0.5.2",
        alphaVideo1Title: "Обзор Alpha 01",
        alphaVideo2Title: "Прохождение",
        alphaVideo3Title: "Стрим с разработчиком",
        alphaUpdateTitle: "Патч 0.0.5.2",
        spoilerGameplay: "Геймплей",
        gameplayContent: "Добавлена 1 точка бандитов на свалке",
        spoilerCraft: "Крафт",
        craftContent: "Метеоритные пули теперь можно скрафтить в лесу",
        spoilerGraphics: "Графика",
        graphicsContent: "Улучшение меню",
        gcVersion: "Обновление 0.1.0",
        gcDownloadNote: "Версия 0.1.0 · Обновление от 01.11.2023",
        gcAboutTitle: "Об игре",
        gcDescription: "Что тут писать? Просто приключение ГКТМО.",
        gcVideo1Title: "Обзор ГК Адвенчур",
        gcVideo2Title: "Прохождение",
        gcUpdateTitle: "Обновление 0.1.0",
        gcUpdateSummary: "Игра вышла",
        gcUpdateContent: "Первый релиз игры.",
        downloadBtn: "Скачать",
        notFoundTitle: "404 — Страница не найдена",
        notFoundDesc: "Запрашиваемая страница не существует или была перемещена.",
        backHome: "Вернуться на главную"
    },
    en: {
        navHome: "Neon Imperium",
        navStarve: "Starve Neon",
        navAlpha: "Alpha 01",
        navGc: "GC Adven",
        siteTitle: "Neon Imperium",
        mainProjectsTitle: "Main Projects",
        mainProjectsDesc: "Priority development games",
        starveDesc: "Survival in a brutal world with progression and genetics.",
        alphaDesc: "Top-down shooter where you are a robot helping soldiers.",
        gcDesc: "Just a GC adventure.",
        detailsBtn: "Details",
        smallProjectsTitle: "Small Projects",
        smallProjectsDesc: "Games made for fun",
        pnsd1Desc: "First part of the crazy series.",
        pnsd2Desc: "Sequel, even crazier.",
        comingSoon: "Coming soon",
        developersTitle: "Developers",
        developersDesc: "Working in free time",
        youtubersTitle: "YouTubers",
        youtubersDesc: "Building community",
        trailerTitle: "Trailer",
        developerTitle: "Developer",
        downloadTitle: "Download",
        descriptionTitle: "Description",
        videoTitle: "Video",
        videoDesc: "Community content",
        updatesTitle: "Updates",
        polls: "Polls",
        downloadNote: "Available on multiple platforms. Stay tuned!",
        starveVersion: "Union 0.13.7",
        worldTitle: "Game World",
        worldDesc: "BRUTAL HARDCORE WORLD. I won't hold your hand, buddy. I'll leave a short tutorial on the basic mechanics, and then you're on your own ;}",
        statusTitle: "Status",
        statusDesc: "Starve Neon is in early development but open for cross-platform multiplayer tests.",
        developmentTitle: "Development",
        developmentDesc: "Complete development system from spears and swords to F***ING MINIGUN, DUDE! Armor for different biomes, modules and a genetics system similar to RimWorld.",
        alliesTitle: "Allies",
        alliesDesc: "Create alliances with factions and other players, take part in arena battles and tame animals. Go on a raid with your clan like Rust.",
        featuresTitle: "Features",
        feature1: "Internet not required.",
        feature2: "Frequent major updates.",
        feature3: "Built-in mod support.",
        feature4: "Direct communication with the developer.",
        feature5: "Multilingual support and easy addition of custom languages and fonts.",
        requirementsTitle: "System Requirements",
        requirementsNote: "Approximate values based on standard settings for these devices",
        fps60: "60+ FPS",
        cpu60: "CPU: Xeon-E2650 v2 3.00 GHz",
        gpu60: "GPU: GT 730 4GB",
        fps180: "180+ FPS",
        cpu180: "CPU: AMD Athlon X4 840 3.10 GHz",
        gpu180: "GPU: GT 1030 2GB",
        fps1000: "1000+ FPS",
        cpu1000: "CPU: AMD Ryzen 7 7435HS 4.00 GHz",
        gpu1000: "GPU: RTX 3050 4GB Laptop",
        consumptionTitle: "Consumption",
        consumptionNote: "Approximate values",
        vram: "VRAM",
        vramVal: "512-1024 MB",
        ram: "RAM",
        ramVal: "512-1024 MB",
        storage: "Storage",
        storageVal: "256 MB",
        os: "OS",
        osVal: "Win 10+ 32 Bit / Android 7+",
        video1Title: "Starve Neon Review",
        video2Title: "Beginner's Guide",
        video3Title: "Multiplayer Walkthrough",
        video4Title: "Highlights",
        video5Title: "Secrets & Easter Eggs",
        starveUpdateTitle: "Patch 0.13.7",
        spoilerTutorial: "Tutorial",
        tutorialContent: "Goals throughout the game",
        spoilerRewards: "Rewards",
        rewardsContent: "Localization\nImproved translation capabilities",
        spoilerQuality: "Quality of Life",
        qualityContent: "Interface\nControls",
        spoilerBalance: "Balance",
        balanceContent: "Level rewards\nProgression changes",
        spoilerBugfix: "Bugfix",
        bugfixContent: "Many minor fixes",
        alphaVersion: "Patch 0.0.5.2",
        alphaDownloadNote: "Version 0.0.5.2 · Update 2024-01-21",
        alphaStoryTitle: "Story",
        alphaStoryDesc: "Alpha 01 is a top-down shooter where you are a robot who must help soldiers, but then everything becomes more complicated than just helping...",
        alphaStatusTitle: "Status",
        alphaStatusDesc: "The game is in active development. Current version: 0.0.5.2",
        alphaVideo1Title: "Alpha 01 Review",
        alphaVideo2Title: "Walkthrough",
        alphaVideo3Title: "Dev Stream",
        alphaUpdateTitle: "Patch 0.0.5.2",
        spoilerGameplay: "Gameplay",
        gameplayContent: "Added 1 bandit point at the dump",
        spoilerCraft: "Crafting",
        craftContent: "Meteorite bullets can now be crafted in the forest",
        spoilerGraphics: "Graphics",
        graphicsContent: "Menu improvement",
        gcVersion: "Update 0.1.0",
        gcDownloadNote: "Version 0.1.0 · Update 2023-11-01",
        gcAboutTitle: "About",
        gcDescription: "What to write? Just a GC adventure.",
        gcVideo1Title: "GC Adven Review",
        gcVideo2Title: "Walkthrough",
        gcUpdateTitle: "Update 0.1.0",
        gcUpdateSummary: "Game released",
        gcUpdateContent: "First release of the game.",
        downloadBtn: "Download",
        notFoundTitle: "404 — Page not found",
        notFoundDesc: "The requested page does not exist or has been moved.",
        backHome: "Back to home"
    }
};

function setLanguage(lang) {
    document.querySelectorAll('[data-lang]').forEach(element => {
        const key = element.getAttribute('data-lang');
        if (translations[lang] && translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.langCode === lang);
    });
    localStorage.setItem('preferredLanguage', lang);
}

// 3D Tilt and Parallax effect
function initTiltEffect() {
    const cards = document.querySelectorAll('.tilt-card');
    cards.forEach(card => {
        const img = card.querySelector('.project-image, .avatar, .video-thumbnail, .game-icon, .feature-icon');
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const rotateX = (y - centerY) / 15;
            const rotateY = (centerX - x) / 15;
            
            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
            
            if (img) {
                const imgX = (x - centerX) / 20;
                const imgY = (y - centerY) / 20;
                img.style.transform = `translate(${imgX}px, ${imgY}px) scale(1.05)`;
            }
        });
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)';
            if (img) {
                img.style.transform = 'translate(0, 0) scale(1)';
            }
        });
    });
}

// LibreCounter functions
async function getLibreCounterCount(pageUrl) {
    try {
        // Use the siteStats endpoint to get counts for all pages
        const hostname = new URL(pageUrl).hostname;
        const response = await fetch(`https://librecounter.org/${hostname}/siteStats?days=9999`);
        const data = await response.json();
        const pagePath = new URL(pageUrl).pathname;
        const pageStat = data.pages.find(p => p.page === pagePath);
        return pageStat ? pageStat.visits : 0;
    } catch (error) {
        console.error('Failed to fetch LibreCounter count:', error);
        return 0;
    }
}

async function incrementLibreCounter(pageUrl) {
    try {
        // Send a beacon or fetch request to increment
        // Using fetch with no-cors as we don't need response
        await fetch(`https://librecounter.org/count?url=${encodeURIComponent(pageUrl)}`, {
            mode: 'no-cors',
        });
        // After increment, fetch the new count
        return await getLibreCounterCount(pageUrl);
    } catch (error) {
        console.error('Failed to increment LibreCounter:', error);
        return 0;
    }
}

// Download counter using LibreCounter
function initDownloadCounter() {
    const downloadSections = document.querySelectorAll('.download-card');
    downloadSections.forEach(async section => {
        // Determine game name from page URL or data attribute
        let game = '';
        const path = window.location.pathname;
        if (path.includes('starve-neon')) game = 'starve-neon';
        else if (path.includes('alpha-01')) game = 'alpha-01';
        else if (path.includes('gc-adven')) game = 'gc-adven';
        else return; // Not a game page
        
        // Construct page URL for LibreCounter
        const pageUrl = `https://neonimperium.com/${game}.html`; // Change to your actual domain
        
        // Get initial count
        let count = await getLibreCounterCount(pageUrl);
        
        // Create or update counter display
        let counterSpan = section.querySelector('.download-counter');
        if (!counterSpan) {
            const header = section.querySelector('h2');
            if (header) {
                counterSpan = document.createElement('span');
                counterSpan.className = 'download-counter';
                header.after(counterSpan);
            }
        }
        if (counterSpan) counterSpan.textContent = count;
        
        // Add click listeners to download buttons
        const buttons = section.querySelectorAll('.download-button');
        buttons.forEach(btn => {
            btn.addEventListener('click', async (e) => {
                e.preventDefault();
                // Increment counter and get new value
                const newCount = await incrementLibreCounter(pageUrl);
                if (counterSpan) counterSpan.textContent = newCount;
                window.open(btn.href, '_blank');
            });
        });
    });
}

document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferredLanguage') || 'ru';
    setLanguage(savedLang);
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            setLanguage(btn.dataset.langCode);
        });
    });
    
    initTiltEffect();
    initDownloadCounter();
});